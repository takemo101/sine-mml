# sine-mml Justfile
# https://github.com/casey/just

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯: ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
default:
    @just --list

# ============================================================================
# ãƒ“ãƒ«ãƒ‰
# ============================================================================

# ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰
build:
    cargo build

# ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
build-release:
    cargo build --release

# å…¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç”¨ï¼‰
build-all: build-release
    @echo "Building for multiple targets..."
    rustup target add x86_64-apple-darwin 2>/dev/null || true
    rustup target add x86_64-unknown-linux-gnu 2>/dev/null || true
    rustup target add x86_64-pc-windows-gnu 2>/dev/null || true
    cargo build --release --target x86_64-apple-darwin || echo "Skipped: x86_64-apple-darwin"

# ============================================================================
# ãƒ†ã‚¹ãƒˆ
# ============================================================================

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
test:
    cargo test

# ãƒ†ã‚¹ãƒˆï¼ˆè©³ç´°å‡ºåŠ›ï¼‰
test-verbose:
    cargo test -- --nocapture

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
test-one name:
    cargo test {{name}} -- --nocapture

# ============================================================================
# Lint & ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
# ============================================================================

# Clippyï¼ˆpedanticï¼‰
lint:
    cargo clippy -- -D warnings

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
fmt:
    cargo fmt

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
fmt-check:
    cargo fmt --check

# å…¨ãƒã‚§ãƒƒã‚¯ï¼ˆCIç”¨ï¼‰
check: fmt-check lint test
    @echo "âœ… All checks passed!"

# ============================================================================
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# ============================================================================

# ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ~/.cargo/binï¼‰
install:
    cargo install --path .

# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uninstall:
    cargo uninstall sine-mml

# ============================================================================
# å®Ÿè¡Œ
# ============================================================================

# ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
run-help:
    cargo run -- --help

# MMLã‚’å†ç”Ÿ
play mml:
    cargo run -- play "{{mml}}"

# å±¥æ­´ã‚’è¡¨ç¤º
history:
    cargo run -- history

# ã‚µãƒ³ãƒ—ãƒ«æ›²ã‚’å†ç”Ÿ
demo:
    @echo "ğŸµ Playing demo song..."
    cargo run -- play "T120 L4 O4 CCGGAAG2 FFEEDDC2"

# ============================================================================
# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
# ============================================================================

# ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’å‰Šé™¤
clean:
    cargo clean

# ============================================================================
# ãƒªãƒªãƒ¼ã‚¹
# ============================================================================

# ãƒªãƒªãƒ¼ã‚¹å‰ãƒã‚§ãƒƒã‚¯
pre-release: check
    @echo "âœ… Ready for release!"

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤º
version:
    @grep '^version' Cargo.toml | head -1

# ============================================================================
# é–‹ç™ºç”¨
# ============================================================================

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
doc:
    cargo doc --open

# ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
update:
    cargo update

# ä¾å­˜é–¢ä¿‚ãƒ„ãƒªãƒ¼ã‚’è¡¨ç¤º
deps:
    cargo tree

# ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆcargo-watchãŒå¿…è¦ï¼‰
watch:
    cargo watch -x test

# ============================================================================
# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# ============================================================================

# é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
setup:
    @echo "ğŸ“¦ Installing development tools..."
    rustup component add clippy rustfmt
    @echo "âœ… Setup complete!"

# Linuxç”¨ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
setup-linux:
    sudo apt-get update
    sudo apt-get install -y libasound2-dev
